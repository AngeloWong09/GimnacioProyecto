@page "/AdministradorCambiarPuntoFuerte"
@using ProyectoGimnacioV2
@using System.ComponentModel.DataAnnotations
@inject NavigationManager Navigation

<h3>Cambiar Punto Fuerte</h3>

<EditForm Model="@cambiarPuntoFuerte" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="coach-id">ID del Entrenador</label>
        <InputText id="coach-id" class="form-control" @bind-Value="cambiarPuntoFuerte.CoachId" />
        <button type="button" class="btn btn-primary mt-2" @onclick="SearchCoach">Buscar Entrenador</button>
    </div>

    <div class="form-group">
        <label for="coach-name">Nombre del Entrenador</label>
        <InputText id="coach-name" class="form-control" @bind-Value="cambiarPuntoFuerte.CoachName" Disabled="true" />
    </div>

    <div class="form-group">
        <label for="current-strength">Punto Fuerte Actual</label>
        <InputText id="current-strength" class="form-control" @bind-Value="cambiarPuntoFuerte.CurrentStrength" Disabled="true" />
    </div>

    <div class="form-group">
        <label for="new-strength">Nuevo Punto Fuerte</label>
        <InputSelect id="new-strength" class="form-control" @bind-Value="cambiarPuntoFuerte.NewStrength">
            <option value="">Seleccione una opción</option>
            <option value="Zumba">Zumba</option>
            <option value="CardioDance">CardioDance</option>
            <option value="Funcionales">Funcionales</option>
        </InputSelect>
    </div>

    <button type="submit" class="btn btn-success">Cambiar Punto Fuerte</button>
</EditForm>

@if (isSuccess)
{
    <div class="alert alert-success mt-3">
        <strong>¡Éxito!</strong> El Punto Fuerte del entrenador fue actualizado correctamente.
    </div>
}

@if (isError)
{
    <div class="alert alert-danger mt-3">
        <strong>Error:</strong> No se encontró un entrenador con el ID proporcionado.
    </div>
}

<button class="btn btn-secondary mt-3" @onclick="GoToAdministrador">Ir a Administrador</button>

@code {
    private CambiarPuntoFuerteViewModel cambiarPuntoFuerte = new CambiarPuntoFuerteViewModel();
    private bool isSuccess = false;
    private bool isError = false;

    private void SearchCoach()
    {
        var entrenador = EntrenadoresData.ListaEntrenadores.FirstOrDefault(e => e.Id.ToString() == cambiarPuntoFuerte.CoachId);

        if (entrenador != null)
        {
            cambiarPuntoFuerte.CoachName = $"{entrenador.Nombre} {entrenador.Apellido}";
            cambiarPuntoFuerte.CurrentStrength = entrenador.PuntosFuertes;
            isError = false;
        }
        else
        {
            cambiarPuntoFuerte.CoachName = string.Empty;
            cambiarPuntoFuerte.CurrentStrength = string.Empty;
            isError = true;
        }
    }

    private void HandleValidSubmit()
    {
        var entrenador = EntrenadoresData.ListaEntrenadores.FirstOrDefault(e => e.Id.ToString() == cambiarPuntoFuerte.CoachId);

        if (entrenador != null)
        {
            entrenador.PuntosFuertes = cambiarPuntoFuerte.NewStrength;
            isSuccess = true;
            isError = false;
        }
        else
        {
            isSuccess = false;
            isError = true;
        }
    }

    private void GoToAdministrador()
    {
        Navigation.NavigateTo("/Administrador");
    }

    public class CambiarPuntoFuerteViewModel
    {
        [Required]
        public string CoachId { get; set; }

        public string CoachName { get; set; }

        public string CurrentStrength { get; set; }

        [Required]
        public string NewStrength { get; set; }
    }
}
