@page "/EntrenadorProgramarClases"

<!DOCTYPE html>
<html>
<head>
    <title>Bienvenido a GYM FAST FORCE!</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <h1 class="title">Bienvenido a GYM FAST FORCE</h1>

    <h2>Administrar Clases</h2>
    <div>
        <button onclick="agregarClase()">Agregar Nueva Clase</button>
        <button onclick="guardarCSV()">Guardar Tabla como CSV</button>
        <button onclick="location.href='/Entrenador'" class="return-btn">Volver al Menú</button>
    </div>
    <br />

    <h3>Agregar Clase</h3>
    <div>
        <label for="idEntrenador">ID Entrenador:</label>
        <input type="text" id="idEntrenador" placeholder="Ej: 1237894">

        <label for="clase">Clase:</label>
        <select id="clase">
            <option value="CardioDance">CardioDance</option>
            <option value="Funcionales">Funcionales</option>
            <option value="Zumba">Zumba</option>
        </select>

        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha">

        <label for="horario">Horario:</label>
        <input type="time" id="horario">

        <label for="cupos">Cupos:</label>
        <select id="cupos">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>

        <label for="precio">Precio Clase:</label>
        <input type="text" id="precio" placeholder="Ej: $2500">
    </div>
    <br />

    <h3>Clases Ingresadas</h3>
    <table id="clasesTable" border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th>Num Clase</th>
                <th>ID Clase</th>
                <th>ID Entrenador</th>
                <th>Clase</th>
                <th>Fecha</th>
                <th>Horario</th>
                <th>Cupos</th>
                <th>Precio Clase</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="clasesTableBody"></tbody>
    </table>

    <script>
        let clases = [];

        // Generar un ID único para "Num Clase" y "ID Clase"
        function generarIdUnico() {
            return Math.floor(100000 + Math.random() * 900000);
        }

        // Cargar el archivo CSV sin mostrar en la tabla
        async function cargarCSV() {
            const archivoCSV = 'sample-data/Clases.csv';
            const urlConCache = `${archivoCSV}?t=${new Date().getTime()}`;

            try {
                const response = await fetch(urlConCache);
                const contenido = await response.text();
                const lineas = contenido.split("\n").filter(linea => linea.trim() !== "");

                clases = lineas.slice(1).map(linea => {
                    const [numClase, idClase, idEntrenador, clase, fecha, horario, cupos, precio] = linea.split(";");
                    return { numClase, idClase, idEntrenador, clase, fecha, horario, cupos, precio };
                });
            } catch (error) {
                console.error("Error al cargar el archivo CSV:", error);
            }
        }

        // Agregar una nueva clase
        async function agregarClase() {
            const idEntrenador = document.getElementById('idEntrenador').value.trim();
            const clase = document.getElementById('clase').value;
            const fecha = document.getElementById('fecha').value;
            const horario = document.getElementById('horario').value;
            const cupos = document.getElementById('cupos').value;
            const precio = document.getElementById('precio').value.trim();

            if (!idEntrenador || !clase || !fecha || !horario || !precio) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            const numClase = generarIdUnico();
            const idClase = generarIdUnico();

            const nuevaClase = {
                numClase: numClase.toString(),
                idClase: idClase.toString(),
                idEntrenador,
                clase,
                fecha,
                horario,
                cupos,
                precio
            };

            clases.push(nuevaClase);

            await guardarClaseCSV(nuevaClase); // Guardar en el archivo CSV
            mostrarClases(); // Mostrar en la tabla
        }

        // Mostrar las clases en la tabla
        function mostrarClases() {
            const tablaBody = document.getElementById('clasesTableBody');
            tablaBody.innerHTML = "";

            clases.forEach(clase => {
                const fila = document.createElement("tr");
                fila.innerHTML = `
                                    <td>${clase.numClase}</td>
                                    <td>${clase.idClase}</td>
                                    <td>${clase.idEntrenador}</td>
                                    <td>${clase.clase}</td>
                                    <td>${clase.fecha}</td>
                                    <td>${clase.horario}</td>
                                    <td>${clase.cupos}</td>
                                    <td>${clase.precio}</td>
                                    <td><button onclick="editarClase(${clase.numClase})">Editar</button></td>
                                `;
                tablaBody.appendChild(fila);
            });
        }

        // Guardar una nueva clase en el archivo CSV
        async function guardarClaseCSV(clase) {
            const nuevaLinea = `${clase.numClase};${clase.idClase};${clase.idEntrenador};${clase.clase};${clase.fecha};${clase.horario};${clase.cupos};${clase.precio}\n`;

            try {
                const archivoCSV = 'sample-data/Clases.csv';
                await fetch(archivoCSV, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: nuevaLinea
                });
            } catch (error) {
                console.error("Error al guardar en el archivo CSV:", error);
            }
        }

        // Guardar todas las clases como un archivo CSV
        function guardarCSV() {
            let csvContent = "Num Clase;ID Clase;ID Entrenador;Clase;Fecha;Horario;Cupos;Precio Clase\n";

            clases.forEach(clase => {
                csvContent += `${clase.numClase};${clase.idClase};${clase.idEntrenador};${clase.clase};${clase.fecha};${clase.horario};${clase.cupos};${clase.precio}\n`;
            });

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "Clases_guardadas.csv";
            link.click();
        }

        // Cargar datos al iniciar
        cargarCSV();

        // Generar las opciones de cupos del 1 al 10
        document.addEventListener('DOMContentLoaded', () => {
            const selectCupos = document.getElementById("cupos");

            if (selectCupos) { // Asegurarse de que el elemento exista
                for (let i = 1; i <= 10; i++) {
                    const option = document.createElement("option");
                    option.value = i;
                    option.textContent = i;
                    selectCupos.appendChild(option);
                }
            } else {
                console.error("No se encontró el elemento con ID 'cupos'");
            }
        });

    </script>
</body>
</html>

